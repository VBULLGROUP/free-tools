# Project Context Documentation

## 1. Tech Stack
- **Framework:** Next.js 15
- **Platform:** Cloudflare Workers (OpenNext)
- **Language:** TypeScript, React 19
- **Styling:** TailwindCSS, PostCSS
- **ORM/DB:** Drizzle ORM, SQLite (Cloudflare D1)
- **Auth:** Custom, Passkey (WebAuthn), SSO (Google), Email/Password
- **Payments:** Stripe
- **Other Libraries:**
  - @radix-ui, @heroicons/react, @heroui/react
  - zod (validation), react-hook-form
  - @tanstack/react-table, clsx, date-fns, etc.

## 2. Directory Structure (src)
- `actions/` — Server actions (credits, sign-out, etc.)
- `app/` — Main Next.js app directory
  - `(admin)/admin` — Admin pages and actions
  - `(auth)` — Auth pages (sign-in, sign-up, reset, verify, SSO)
  - `(dashboard)/dashboard` — User dashboard, billing, marketplace
  - `(legal)` — Legal pages (privacy, terms)
  - `(marketing)` — Marketing/landing pages
  - `(settings)/settings` — User settings, security, sessions
  - `api/` — API routes (e.g. `/api/get-session`)
- `components/` — Shared React components
- `utils/` — Utility functions (credits, auth, etc.)
- `lib/` — Third-party integrations (stripe, etc.)
- `db/` — Database schema and access

## 3. Route & Page Structure
### Public Pages
- `/` — Home/landing (marketing)
- `/sign-in` — Sign in
- `/sign-up` — Sign up
- `/forgot-password` — Forgot password
- `/reset-password` — Reset password
- `/verify-email` — Email verification
- `/legal/privacy` — Privacy policy
- `/legal/terms` — Terms of service

### Authenticated User Pages
- `/dashboard` — User dashboard
  - `/dashboard/billing` — Billing & credits
  - `/dashboard/marketplace` — Component marketplace
- `/settings` — Account settings
  - `/settings/security` — Passkey management
  - `/settings/sessions` — Active sessions

### Admin Pages
- `/admin` — Admin dashboard (user management, etc.)

### API Routes
- `/api/get-session` — Get current session and config

## 4. Main Features & Functions
- **Authentication:**
  - Email/password, email verification, password reset
  - Google SSO
  - Passkey (WebAuthn) registration and management
- **User Dashboard:**
  - View and manage credits
  - Purchase credit packages (Stripe integration)
  - Access component marketplace
- **Admin:**
  - Manage users
- **Settings:**
  - Update profile, manage sessions, passkeys
- **Legal:**
  - Privacy, terms

## 5. API Details
### `/api/get-session` (GET)
- **Description:** Lấy thông tin session hiện tại và config hệ thống
- **Request:** None
- **Response:**
  - `session`: Thông tin user session (hoặc null)
  - `config`: Cấu hình hệ thống
- **Headers:**
  - Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0
  - Pragma: no-cache
  - Expires: 0

### Server Actions (trích xuất từ actions/ và các page)
- **credits.action.ts**
  - Lấy lịch sử giao dịch credit, cập nhật credit, log giao dịch, mua credit qua Stripe
- **sign-out.action.ts**
  - Đăng xuất user
- **forgot-password.action.ts**
  - Gửi email reset password, xác thực captcha, rate limit
- **reset-password.action.ts**
  - Đặt lại mật khẩu mới, xác thực token
- **sign-in.actions.ts**
  - Đăng nhập user
- **sign-up.actions.ts**
  - Đăng ký tài khoản
- **verify-email.action.ts**
  - Xác thực email
- **settings.actions.ts**
  - Cập nhật profile, rate limit
- **sessions.actions.ts**
  - Lấy, xóa session
- **passkey actions**
  - Đăng ký, xóa passkey (WebAuthn)

## 6. Chức Năng Chính
- Quản lý tài khoản, xác thực đa yếu tố
- Quản lý credit, giao dịch và mua bán
- Quản lý thành phần marketplace
- Quản trị user (admin)
- Quản lý session, bảo mật (passkey)

---

*Generated by AI codebase scan — 2025-05-13*
